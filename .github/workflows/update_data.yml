name: Scheduled Data Update

on:
  # 設定排程：每天格林威治時間 00:00 執行 (台灣時間早上 8 點)
  schedule:
    - cron: '0 0 * * *'
  # 也可以手動運行
  workflow_dispatch:

jobs:
  run_scraper_and_update_data:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository code
        uses: actions/checkout@v4

      # 步驟 A: 安裝 Chrome/Chromedriver (修正版)
      - name: Install necessary tools (Chromium)
        run: |
          sudo apt-get update
          # 安裝無頭 Chrome 瀏覽器
          sudo apt-get install chromium-browser -y
          # 安裝 ChromeDriver
          sudo apt-get install chromium-chromedriver -y
          
          # **【最終關鍵】**
          # 建立一個符號連結 (Symbolic Link)，讓系統知道 "chromedriver" 其實就是 "chromium-chromedriver"
          # 這樣 Selenium 才能找到它
          sudo ln -s /usr/lib/chromium-browser/chromedriver /usr/local/bin/chromedriver

    # 步驟 B: 執行爬蟲和地理編碼 (確保它是乾淨的)
      - name: Run Scraper and Geocoding
        run: |
          echo "--- Starting Scraper ---"
          # 執行爬蟲
          python auto_scraper.py 
          
          echo "--- Starting Geocoding ---"
          # 執行地理編碼
          python geocode.py

      # 步驟 C: 提交更新的資料
      - name: Commit and Push new data to GitHub
        run: |
          git config user.name 'GitHub Actions'
          git config user.email 'actions@github.com'
          # 檢查是否有任何變動 (避免錯誤)
          git add MOHW_counseling_data_FINAL.csv
          git commit -m "SCHEDULER: Auto update counseling data with latest availability." || echo "No changes to commit"
          # 強制推送到倉庫
          git push
